<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Image-to-Depth Web Viewer</title>
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <canvas id="glCanvas"></canvas>
    <button id="toggle-ui" class="toggle-ui">Hide UI</button>
    <button id="toggle-ui-mirror" class="toggle-ui mirror" aria-hidden="true">Hide UI</button>
    <div id="control-panel" class="control-panel">
      <header>
        <h1>Image-to-Depth Web Viewer</h1>
        <p class="subtitle">Run Apple Depth Pro on standard images to build 3D meshes and export depth-augmented PNGs (RGBDE PNGs).</p>
      </header>
      <section class="controls">
        <div class="control grouped">
          <label for="source-input">2D Image (JPEG or PNG)</label>
          <div class="actions">
            <label class="file-label">
              <input id="source-input" data-sync="source" type="file" accept=".jpg,.jpeg,.png" />
              <span data-bind="sourceFile">No file selected</span>
            </label>
            <button id="generate-depth" data-sync="generate" type="button">Generate Depth</button>
            <button id="save-rgbde" data-sync="save" type="button" disabled>Save RGBDE</button>
          </div>
          <p class="hint" data-bind="backendStatus">Depth service: checking…</p>
        </div>
        <div class="control">
          <label for="file-input">Load RGBDE PNG file</label>
          <input id="file-input" type="file" accept=".png" class="visually-hidden" />
          <button id="open-dialog" type="button">Open file…</button>
        </div>
        <div class="control">
          <label for="display-mode">Display Mode</label>
          <select id="display-mode" data-sync="displayMode">
            <option value="mono">2D</option>
            <option value="sbs">3D SBS</option>
          </select>
        </div>
        <div class="control">
          <label for="geom-fov">Geometry FOV <span data-bind="geomFovValue">60</span>°</label>
          <input id="geom-fov" data-sync="geomFov" type="range" min="15" max="120" step="1" value="60" />
        </div>
        <div class="control">
          <label for="stereo-separation">Stereo Separation <span data-bind="stereoValue">0.02</span> m</label>
          <input id="stereo-separation" data-sync="stereoSeparation" type="range" min="0" max="0.10" step="0.002" value="0.02" />
        </div>
        <div class="control">
          <label for="magnification">Depth Magnification <span data-bind="magnificationValue">1.00</span>x</label>
          <input id="magnification" data-sync="magnification" type="range" min="0" max="100" step="1" value="0" />
        </div>
        <div class="control">
          <label for="z-offset">Model Z Offset <span data-bind="zOffsetValue">0.00</span> m</label>
          <input id="z-offset" data-sync="zOffset" type="range" min="-5" max="5" step="0.01" value="0" />
        </div>
        <div class="control">
          <label for="far-clip">Far Crop Distance <span data-bind="farClipValue">1000</span> m</label>
          <input id="far-clip" data-sync="farClip" type="range" min="0" max="100" step="1" value="100" />
        </div>
        <div class="control toggle">
          <span>Depth Mode</span>
          <label class="switch">
            <input id="depth-mode" data-sync="depthMode" type="checkbox" />
            <span class="slider round"></span>
          </label>
          <span class="mode-label" data-bind="depthMode">Linear</span>
        </div>
        <div class="control">
          <label for="log-power">Log Power <span data-bind="logPowerValue">1.00</span></label>
          <input id="log-power" data-sync="logPower" type="range" min="0.10" max="4.00" step="0.05" value="1.00" />
        </div>
        <div class="control">
          <label for="fov">Screen FOV <span data-bind="fovValue">60</span>°</label>
          <input id="fov" data-sync="fov" type="range" min="15" max="120" step="1" value="60" />
        </div>
      </section>
      <div class="control toggle">
        <span>Swap Left/Right for Cross-Eyed Viewing</span>
        <label class="switch">
          <input id="swap-eyes" data-sync="swapEyes" type="checkbox" />
          <span class="slider round"></span>
        </label>
      </div>
      <section class="instructions">
        <h2>Controls</h2>
        <ul>
          <li>Use <strong>Generate Depth</strong> to run Depth Pro on a JPG/PNG (requires backend).</li>
          <li><strong>Save RGBDE</strong> downloads the currently loaded PNG to your machine.</li>
          <li>Left-drag to rotate (±30° clamp per axis).</li>
          <li>Right-drag to pan the model.</li>
          <li>Mouse wheel to zoom in/out.</li>
          <li>Double-click canvas to reset view.</li>
          <li>Toggle the panel with the Hide UI button.</li>
          <li>Drop an RGBDE PNG anywhere in the window to load it.</li>
        </ul>
      </section>
    </div>
    <div id="drop-hint" class="drop-hint hidden">Drop RGBDE PNG here…</div>
    <div id="status" class="status"></div>
    <div id="control-panel-mirror" class="control-panel mirror" aria-hidden="true"></div>

    <script type="module" src="./src/app.js"></script>
  </body>
</html>
